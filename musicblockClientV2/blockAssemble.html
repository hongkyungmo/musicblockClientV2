<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />


	<!-- jQuery CDN -->
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
	<script src="https://code.jquery.com/jquery-2.2.2.js"></script>
	<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	<!-- <link rel="stylesheet" href="/resources/demos/style.css"> -->

	<!-- touchpunch -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>

	<!-- 부트스트랩 CDN -->
	<!-- 합쳐지고 최소화된 최신 CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
	<!-- 부가적인 테마 -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
	<!-- 합쳐지고 최소화된 최신 자바스크립트 -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
	
	
	<style>
		html, body {
			height: 100%;
			width: 100%;
			overflow: hidden;
		}
		/*메뉴바*/
		#menubar{
			height:12%;
			width:100%;
			background-color:black;
		}
		/*레이어*/
		#dest-wrapper{
			position:relative;
			height:80px;
			width:100%;
			background-color:green;
		}
		#dest-piano{
			position:relative;
			left:80px;
			height:60px;
			width:560px;
			padding:0px 0px 10px 0px;
			background-color:greenyellow;
		}
		#dest-scrollbar{
			position:relative;
			left:80px;
			height:20px;
			width:100%;
			padding:1px;
			background-color:lightgray;
		}
		#dest-scrollbar-walker{
			position:relative;
			height:18px;
			width:10%;
			background-color:black;
		}
		#sourceWrapper{
			position:relative;
			height:300%;
			width:100%;
			background-color:blue;
		}
		#source{
			position:relative;
			left:80px;
			height:30%;
			width:450px;
			padding:0px 0px 10px 0px;
			background-color:cornflowerblue;
		}
		/*아이템*/
		.item{
			float:left;
			width:100px;
			height:40px;
			margin:10px 0px 0px 10px;
			background-color:crimson;
		}
	</style>
	
	<script>
		$(function(){
			$(".item").draggable({
				opacity:"0.8",
				helper:function(){
					return $(this).clone();
				},
				revert:function(event,ui){
					if(event==false){
						return true;
					}else{
						return false;
					}
				},
				stop:function(event,ui){
					
				}
			});
			$("#dest-piano").droppable({
				accept:".item",
				drop:function(event,ui){
					//놓인 곳의 부모와의 상대좌표
					var destPosX = $(".item:last").offset().left - $(this).offset().left;
					var destPosY =  $(".item:last").offset().top - $(this).offset().top;
					console.log("x : " + destPosX + ", y : " + destPosY);
					
					//여태까지 추가되었던 아이템 갯수
					var itemLength = $("#dest-piano > .item").length;
					
					//추가될 위치 계산
					var centerPosX = destPosX - 10;
					var destIndex = Math.floor(centerPosX/110);
					console.log("destIndex : " + destIndex);
					
					//아이템(추가된 것 반영)에 맞게 컨테이너 폭 넓히기
					if(itemLength >= 5){
						var destWidth = $("#dest-piano").css("width");
						var destInt = parseInt(destWidth);
						destInt += 110;
						$("#dest-piano").css("width", destInt + "px");
					}
					
					//아이템 복사
					var cloneItem = $(".item:last").clone();
					cloneItem.css("top", "0px").css("opacity", "1").css("background-color", "yellow").css("position", "relative").css("left", "0px");
					
					//아이템 추가(DOM트리에 추가 및 화면에 표시)
					
					if(itemLength == 0){//추가된 아이템이 없을 때
						console.log("디버깅1");
						$("#dest-piano").append(cloneItem);
					}else if(itemLength < destIndex+1){//추가된 아이템보다 뒤쪽으로 추가될 때
						console.log("디버깅2");
						$("#dest-piano > .item:last").after(cloneItem);
					}else{//추가된 아이템보다 앞쪽이거나 아이템 중간에 삽입
						if(destIndex == -1){//추가된 아이템보다 앞쪽으로 추가될 때
							$("#dest-piano > .item:eq(0)").before(cloneItem);
						}else{//일반적 추가
							$("#dest-piano > .item:eq("+destIndex+")").after(cloneItem);
						}
					}
				}
			});
		});
	</script>
</head>

<body>
	<!--메뉴바-->
	<div id="menubar"></div>
	
	<!--작곡(결과물)-->
	<div id="dest-wrapper">
		<div id="dest-scrollbar">
			<div id="dest-scrollbar-walker"></div>
		</div>
		<div id="dest-piano"></div>
	</div>
	
	
	<!--블럭(재료)-->
	<div id="sourceWrapper">
		<div id="source">
			<div class="item">1</div>
			<div class="item">2</div>
			<div class="item">3</div>
			<div class="item">4</div>
			<div class="item">5</div>
			<div class="item">6</div>
			<div class="item">7</div>
			<div class="item">8</div>
			<div class="item">9</div>
			<div class="item">10</div>
			<div class="item">11</div>
			<div class="item">12</div>
			<div class="item">13</div>
			<div class="item">14</div>
			<div class="item">15</div>
			<div class="item">16</div>
			<div class="item">17</div>
			<div class="item">18</div>
			<div class="item">19</div>
			<div class="item">20</div>
			<div class="item">21</div>
			<div class="item">22</div>
			<div class="item">23</div>
			<div class="item">24</div>
			<div class="item">25</div>
			<div class="item">26</div>
			<div class="item">27</div>
			<div class="item">28</div>
			<div class="item">29</div>
			<div class="item">30</div>
		</div>
	</div>
</body>

</html>